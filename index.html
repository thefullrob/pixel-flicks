<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Flicks: Movie Poster Quiz</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for generating sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .game-container {
            width: 100%;
            max-width: 700px;
            background-color: #2d3748;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            position: relative; /* Needed for score and overlay positioning */
            overflow: hidden; /* Keeps the overlay inside the rounded corners */
        }
        #posterCanvas {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background-color: #000;
        }
        .choice-button {
            transition: background-color 0.15s ease-in-out, transform 0.1s;
        }
        .choice-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
        }
        .choice-button.correct {
            background-color: #10b981; /* Green 500 */
        }
        .choice-button.incorrect {
            background-color: #ef4444; /* Red 500 */
        }
        .choice-button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .timer-bar-bg {
            height: 10px;
            background-color: #4a5568;
            border-radius: 9999px;
            overflow: hidden;
        }
        #timerBar {
            height: 100%;
            background-color: #3b82f6; /* Blue 500 */
            transition: width 1s linear;
        }

        /* --- ANIMATIONS --- */

        @keyframes score-fly {
            0% { opacity: 1; transform: scale(1.5) translateY(0); }
            100% { opacity: 0; transform: scale(0.5) translateY(-50px); }
        }
        .score-popup {
            position: absolute;
            font-size: 2.5rem;
            font-weight: bold;
            color: #34d399; /* Emerald Green */
            animation: score-fly 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 10;
            text-shadow: 0 0 10px rgba(52, 211, 153, 0.7);
        }

        @keyframes pop-in {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .result-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0); /* Start hidden */
            background: rgba(31, 41, 55, 0.95); /* Dark gray, slightly transparent */
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            z-index: 50;
            border: 4px solid #4b5563;
            box-shadow: 0 0 30px rgba(0,0,0,0.9);
            width: 80%;
            max-width: 400px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s ease;
        }

        .result-overlay.active {
            animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            pointer-events: auto;
        }

        /* Text styling for the result */
        .result-title { font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 2px; }
        .result-score { font-size: 1.5rem; color: #e5e7eb; margin-bottom: 1.5rem; }
        .text-glow-green { text-shadow: 0 0 15px rgba(52, 211, 153, 0.8); color: #34d399; }
        .text-glow-red { text-shadow: 0 0 15px rgba(239, 68, 68, 0.8); color: #ef4444; }
        .text-glow-gold { text-shadow: 0 0 15px rgba(251, 191, 36, 0.8); color: #fbbf24; }

    </style>
</head>
<body>

    <div id="game-app" class="game-container p-6 text-white">

        <!-- NEW: The Pop-up Result Overlay -->
        <div id="resultOverlay" class="result-overlay">
            <div id="resultTitle" class="result-title">CORRECT!</div>
            <div id="resultScore" class="result-score">+100 Points</div>
            <button id="overlayNextButton" class="px-8 py-3 bg-indigo-600 hover:bg-indigo-500 text-white text-xl font-bold rounded-full shadow-lg transition transform hover:scale-105" onclick="nextRound()">
                Next Round
            </button>
        </div>

        <!-- Header, Sound Button, and Share Button -->
        <div class="flex justify-between items-center mb-6">
            <!-- LOGO IMAGE -->
            <div class="flex-grow">
                <img src="./images/logo.png" alt="Pixel Flicks" class="h-16 sm:h-24 object-contain origin-left">
            </div>
            
            <div class="flex space-x-2 sm:space-x-3 items-center">
                <button id="shareButton" 
                        class="px-3 py-2 sm:px-4 bg-green-600 hover:bg-green-500 text-white rounded-full text-xs sm:text-sm transition duration-150 flex items-center"
                        onclick="shareGame()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="mr-1" viewBox="0 0 16 16">
                        <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .6 1.636L7.42 7.391a2.5 2.5 0 0 1-2.858-.133L1.5 8.587A2.5 2.5 0 1 1 1.5 13a2.5 2.5 0 0 1 1.488-.679l3.05-1.525a2.47 2.47 0 0 1 1.056-.12l3.411 3.411a2.5 2.5 0 1 1 2.5-2.5 2.5 2.5 0 0 1-.6-1.636l-3.957-3.957a2.5 2.5 0 0 1 .133-2.858L10.364 2.52a2.5 2.5 0 0 1-.6-.636zm2-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM1.5 11a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                    </svg>
                    Share
                </button>
                <button id="musicButton" 
                        class="px-3 py-2 sm:px-4 bg-gray-600 hover:bg-gray-500 text-white rounded-full text-xs sm:text-sm transition duration-150 flex items-center"
                        onclick="toggleMusic()">
                    <span id="musicIcon" class="mr-1">&#128266;</span> Sound ON
                </button>
            </div>
        </div>
        
        <!-- Game Content -->
        <div id="gameContent" class="">
            
            <!-- Scoreboard and Timer -->
            <div id="scoreboard" class="flex flex-col gap-3 mb-4 p-3 bg-gray-700 rounded-lg">
                <div id="scoreDisplay1P" class="flex justify-between items-center">
                    <div class="text-xl font-semibold player-1-color">
                        Score: <span id="totalScore1P">0</span> 
                    </div>
                    <div class="text-sm font-medium text-gray-400" id="stageIndicator">
                        Stage 1
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-xl font-semibold">Round: <span id="roundNumber">1</span></div>
                    <div class="text-xl font-semibold">Current Points: <span id="currentPoints">100</span></div>
                </div>
            </div>

            <!-- Timer Bar -->
            <div class="mb-4">
                <p class="text-sm text-gray-400 mb-1">Time Remaining: <span id="timeLeftDisplay">15</span>s</p>
                <div class="timer-bar-bg">
                    <div id="timerBar" style="width: 100%;"></div>
                </div>
            </div>
            
            <!-- Poster Canvas Area -->
            <div class="flex justify-center">
                <canvas id="posterCanvas" width="300" height="450" class="rounded-lg shadow-xl"></canvas>
            </div>

            <!-- Status Message (Kept for fallback) -->
            <div class="text-center my-4">
                <p id="statusMessage" class="text-lg font-medium min-h-[1.5rem] text-gray-400"></p>
                <!-- Note: The 'Start Game' button is now handled mostly by the overlay, but we keep this for the very first start -->
                <button id="initialStartButton" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-full mt-2" onclick="nextRound()">
                    Start Game
                </button>
            </div>

            <!-- Multiple Choice Buttons -->
            <div id="choicesContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-4">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>

    </div>

    <!-- 1. Load the external data file (CRITICAL FOR 25 ROUNDS) -->
    <script src="./movie-data.js"></script>

    <!-- 2. Game logic script -->
    <script>
        // --- Tone.js Setup ---
        let isMuted = false; // Default to false (Sound ON)
        const musicButtonEl = document.getElementById('musicButton');
        const musicIconEl = document.getElementById('musicIcon');
        let winSynth = null;
        let loseSynth = null;

        function setupMusic() {
            if (winSynth && loseSynth) return; // Prevent creating multiple synths

            // FIX: Use PolySynth to allow multiple notes (chords) without freezing
            winSynth = new Tone.PolySynth(Tone.Synth, { 
                oscillator: { type: "triangle" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.5 }
            }).toDestination();
            winSynth.volume.value = -8;

            loseSynth = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "sine" },
                envelope: { attack: 0.1, decay: 0.5, sustain: 0, release: 0.5 }
            }).toDestination();
            loseSynth.volume.value = -6;
        }
        
        function playSound(isCorrect) {
            if (isMuted || !window.Tone || !winSynth || !loseSynth) return;
            if (isCorrect) {
                winSynth.triggerAttackRelease(["C5", "E5", "G5"], "8n");
            } else {
                loseSynth.triggerAttackRelease(["C2", "G1"], "4n");
            }
        }

        async function toggleMusic() {
            // Ensure context is running on toggle
            if (Tone.context.state !== 'running') {
                await Tone.start();
            }
            setupMusic(); 

            isMuted = !isMuted;
            if (isMuted) {
                musicIconEl.innerHTML = '&#128263;'; 
                musicButtonEl.innerHTML = '<span id="musicIcon" class="mr-1">&#128263;</span> Sound OFF'; 
            } else {
                musicIconEl.innerHTML = '&#128266;'; 
                musicButtonEl.innerHTML = '<span id="musicIcon" class="mr-1">&#128266;</span> Sound ON'; 
            }
        }

        // --- Configuration ---
        const TIMER_MAX = 15;
        const REVEAL_LIMIT = 1.0; // FULL REVEAL
        const MAX_SCORE = 100;
        const CHUNK_SIZE = 7; // Small pixels

        // Progression Thresholds
        const STAGE_1_PASS_SCORE = 500;
        const BONUS_ROUND_UNLOCK_SCORE = 1000;

        // --- Game State Variables ---
        let gameState = {
            totalScore: 0,
            round: 0,
            currentMovie: null,
            timerInterval: null,
            timeLeft: TIMER_MAX,
            isGameOver: true,
            posterImage: new Image(),
            pixelatedChunks: []
        };

        // NEW: Game List Array to store the shuffled order
        let gameMovies = [];
        let attractModeAnimationId = null; // For the retro static effect
        
        // --- DOM References ---
        const totalScoreEl = document.getElementById('totalScore1P'); 
        const stageIndicatorEl = document.getElementById('stageIndicator');
        const roundNumberEl = document.getElementById('roundNumber');
        const currentPointsEl = document.getElementById('currentPoints');
        const timeLeftDisplayEl = document.getElementById('timeLeftDisplay');
        const timerBarEl = document.getElementById('timerBar');
        const statusMessageEl = document.getElementById('statusMessage');
        const initialStartButton = document.getElementById('initialStartButton');
        const choicesContainerEl = document.getElementById('choicesContainer');
        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        
        // New Overlay References
        const resultOverlayEl = document.getElementById('resultOverlay');
        const resultTitleEl = document.getElementById('resultTitle');
        const resultScoreEl = document.getElementById('resultScore');
        const overlayNextButtonEl = document.getElementById('overlayNextButton');

        const CANVAS_W = canvas.width;
        const CANVAS_H = canvas.height;

        // --- Share Function ---
        async function shareGame() {
            const finalScore = gameState.totalScore;
            const message = `I just scored ${finalScore} points in Pixel Flicks: The Movie Poster Quiz! Can you beat me?`;
            const shareUrl = window.location.href; 
            
            if (navigator.share) {
                try {
                    await navigator.share({ title: 'Pixel Flicks', text: message, url: shareUrl });
                    statusMessageEl.textContent = "Shared successfully!";
                } catch (error) { copyToClipboard(message, shareUrl); }
            } else {
                copyToClipboard(message, shareUrl);
            }
        }

        function copyToClipboard(message, url) {
             const tempInput = document.createElement('textarea');
             tempInput.value = `${message} Play here: ${url}`;
             document.body.appendChild(tempInput);
             tempInput.select();
             document.execCommand('copy');
             document.body.removeChild(tempInput);
             
             statusMessageEl.textContent = "Link copied! Share with friends!";
             statusMessageEl.classList.add('text-yellow-400');
             setTimeout(() => { statusMessageEl.classList.remove('text-yellow-400'); }, 3000);
        }
        
        // --- Retro Attract Mode Animation ---
        function startAttractMode() {
            // Only start if not already running
            if (attractModeAnimationId) return;

            function animate(time) {
                // Create random noise
                const idata = ctx.createImageData(CANVAS_W, CANVAS_H);
                const buffer32 = new Uint32Array(idata.data.buffer);
                const len = buffer32.length;

                for (let i = 0; i < len; i++) {
                    if (Math.random() < 0.1) {
                        buffer32[i] = 0xff222222; // Dark gray noise
                    } else {
                        buffer32[i] = 0xff000000; // Black background
                    }
                }
                ctx.putImageData(idata, 0, 0);

                // Draw Blinking Text
                // Blink roughly every 800ms
                if (Math.floor(Date.now() / 800) % 2 === 0) {
                    ctx.fillStyle = "#fcd34d"; // Amber/Gold color
                    ctx.font = "bold 30px 'Courier New', monospace";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("PRESS START", CANVAS_W / 2, CANVAS_H / 2);
                }

                attractModeAnimationId = requestAnimationFrame(animate);
            }
            animate();
        }

        function stopAttractMode() {
            if (attractModeAnimationId) {
                cancelAnimationFrame(attractModeAnimationId);
                attractModeAnimationId = null;
            }
        }

        // --- Initialization and Game Flow ---

        window.onload = () => {
            setupMusic(); 
            // Set default to Sound ON
            isMuted = false;
            musicIconEl.innerHTML = '&#128266;'; 
            musicButtonEl.innerHTML = '<span id="musicIcon" class="mr-1">&#128266;</span> Sound ON'; 
            
            statusMessageEl.textContent = 'Welcome to Pixel Flicks! Click START GAME to begin.';
            
            // Start the retro TV static animation immediately
            startAttractMode();

            // Load Data
            if (typeof movieData !== 'undefined' && movieData.length > 0) {
                 gameMovies = [...movieData];
                 shuffleArray(gameMovies);
                 // Note: We don't draw the first poster yet, we let the Attract Mode run
            } else {
                 statusMessageEl.textContent = "Error: movie-data.js file not found or empty.";
            }

            // Attach listener to Start Game button to wake up AudioContext
            initialStartButton.addEventListener('click', async () => {
                if (Tone.context.state !== 'running') {
                    await Tone.start();
                }
            });
        };

        function calculateScore() {
            if (gameState.timeLeft <= 0) return 0;
            const score = Math.round((gameState.timeLeft / TIMER_MAX) * MAX_SCORE);
            return score;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // --- Canvas and Reveal Logic ---
        function drawPoster(url, pixelate = false) {
            ctx.clearRect(0, 0, CANVAS_W, CANVAS_H);
            gameState.posterImage.onload = () => {
                ctx.drawImage(gameState.posterImage, 0, 0, CANVAS_W, CANVAS_H);
                if (pixelate) {
                    gameState.pixelatedChunks = [];
                    for (let x = 0; x < CANVAS_W; x += CHUNK_SIZE) {
                        for (let y = 0; y < CANVAS_H; y += CHUNK_SIZE) {
                            gameState.pixelatedChunks.push({ x: x, y: y, revealed: false });
                            ctx.fillStyle = '#222222'; 
                            ctx.fillRect(x, y, CHUNK_SIZE, CHUNK_SIZE);
                        }
                    }
                    shuffleArray(gameState.pixelatedChunks);
                }
            };
            gameState.posterImage.onerror = () => {
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(0, 0, CANVAS_W, CANVAS_H);
                ctx.fillStyle = '#fff';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('ERROR LOADING IMAGE', CANVAS_W / 2, CANVAS_H / 2);
            };
            gameState.posterImage.crossOrigin = "anonymous"; 
            gameState.posterImage.src = url;
        }
        
        function revealPosterPiece() {
            const timeElapsedRatio = (TIMER_MAX - gameState.timeLeft) / TIMER_MAX;
            if (timeElapsedRatio >= REVEAL_LIMIT) return;
            
            const totalChunks = gameState.pixelatedChunks.length;
            const targetIndex = Math.floor(totalChunks * timeElapsedRatio);

            // Get image dimensions to calculate scaling
            const imgWidth = gameState.posterImage.naturalWidth;
            const imgHeight = gameState.posterImage.naturalHeight;
            
            if (!imgWidth || !imgHeight) return;

            const scaleX = imgWidth / CANVAS_W;
            const scaleY = imgHeight / CANVAS_H;

            for (let i = 0; i < targetIndex; i++) {
                const chunk = gameState.pixelatedChunks[i];
                if (!chunk.revealed) {
                    const sx = chunk.x * scaleX;
                    const sy = chunk.y * scaleY;
                    const sWidth = CHUNK_SIZE * scaleX;
                    const sHeight = CHUNK_SIZE * scaleY;

                    ctx.drawImage(gameState.posterImage, sx, sy, sWidth, sHeight, chunk.x, chunk.y, CHUNK_SIZE, CHUNK_SIZE);
                    chunk.revealed = true;
                }
            }
        }
        
        function fullReveal() {
            ctx.drawImage(gameState.posterImage, 0, 0, CANVAS_W, CANVAS_H);
            gameState.pixelatedChunks.forEach(chunk => chunk.revealed = true);
        }

        // --- Game Flow Functions ---

        function startTimer() {
            gameState.timeLeft = TIMER_MAX;
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft -= 1;
                const currentScore = calculateScore();
                currentPointsEl.textContent = currentScore;
                timeLeftDisplayEl.textContent = gameState.timeLeft;
                timerBarEl.style.width = `${(gameState.timeLeft / TIMER_MAX) * 100}%`;
                revealPosterPiece();
                if (gameState.timeLeft <= 0) {
                    endRound(false); 
                }
            }, 1000);
        }

        function nextRound() {
            // Hide overlay if it's open
            resultOverlayEl.classList.remove('active');

            // NEW: Stop attract mode animation if running (on first click)
            stopAttractMode();

            // UPDATED: Check against gameMovies instead of movieData
            if (gameMovies.length === 0) {
                statusMessageEl.textContent = "Error loading data.";
                return;
            }

            if (gameState.round >= gameMovies.length) {
                // Game Completed (Finished Bonus Round)
                showGameOver(`CONGRATS!`, `You beat the game! Final Score: ${gameState.totalScore}`);
                return;
            }
            
            gameState.isGameOver = false;
            gameState.round++;
            // UPDATED: Use gameMovies to get the random movie
            gameState.currentMovie = gameMovies[gameState.round - 1];

            // Update Stage Indicator
            let stageText = "Stage 1";
            if (gameState.round > 20) stageText = "BONUS ROUND";
            else if (gameState.round > 10) stageText = "Stage 2";
            stageIndicatorEl.textContent = stageText;

            clearInterval(gameState.timerInterval);
            currentPointsEl.textContent = MAX_SCORE;
            roundNumberEl.textContent = gameState.round;
            
            statusMessageEl.textContent = ""; 
            initialStartButton.classList.add('hidden'); 
            
            drawPoster(gameState.currentMovie.image, true);
            renderChoices(gameState.currentMovie.options);
            
            startTimer();
        }

        function renderChoices(choices) {
            choicesContainerEl.innerHTML = '';
            const optionsMap = ['A', 'B', 'C', 'D'];
            choices.forEach((title, index) => {
                const optionChar = optionsMap[index];
                const button = document.createElement('button');
                button.className = 'choice-button px-4 py-3 bg-blue-600 text-white font-semibold rounded-lg text-left';
                button.setAttribute('data-choice', optionChar);
                button.onclick = (e) => checkAnswer(optionChar, e.currentTarget);
                button.textContent = `${optionChar}) ${title} (${gameState.currentMovie.year})`;
                choicesContainerEl.appendChild(button);
            });
        }

        function checkAnswer(chosenOption, button) {
            clearInterval(gameState.timerInterval); 
            if (gameState.isGameOver) return; 
            const isCorrect = chosenOption === gameState.currentMovie.correct;
            endRound(isCorrect, button);
        }

        function showGameOver(title, message, allowRetry = true) {
            resultTitleEl.textContent = title;
            resultTitleEl.className = "result-title text-yellow-400";
            resultScoreEl.textContent = message;
            
            // UPDATED: Share Button on Game Over
            overlayNextButtonEl.textContent = "Send to a Friend";
            overlayNextButtonEl.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
            overlayNextButtonEl.classList.add('bg-green-600', 'hover:bg-green-500');
            overlayNextButtonEl.onclick = shareGame; 
            
            // Note: To properly restart, user needs to refresh or we add a secondary button. 
            // For simplicity sharing is the primary action here.
            
            resultOverlayEl.classList.add('active');
        }

        function endRound(isCorrect, clickedButton = null) {
            gameState.isGameOver = true;
            playSound(isCorrect);
            fullReveal();

            let roundPoints = 0;
            let resultTitleText = "";
            let resultScoreText = "";
            let titleClass = "result-title";
            let btnText = "Next Poster";
            let btnAction = nextRound;

            // Prepare Overlay Content
            if (isCorrect) {
                roundPoints = calculateScore();
                gameState.totalScore += roundPoints;
                totalScoreEl.textContent = gameState.totalScore;
                
                resultTitleText = "CORRECT!";
                titleClass += " text-glow-green";
                resultScoreText = `+${roundPoints} Points`;
                
            } else {
                resultTitleText = "WRONG!"; 
                if (!clickedButton) resultTitleText = "TIME'S UP!";
                titleClass += " text-glow-red";
                resultScoreText = `The answer was:\n${gameState.currentMovie.title}`;
            }

            // --- STAGE PROGRESSION CHECKS ---
            // Check after Round 10 (End of Stage 1)
            if (gameState.round === 10) {
                if (gameState.totalScore < STAGE_1_PASS_SCORE) {
                    resultTitleText = "GAME OVER";
                    titleClass = "result-title text-glow-red";
                    resultScoreText = `Score: ${gameState.totalScore}. You need ${STAGE_1_PASS_SCORE} to advance.`;
                    btnText = "Send to a Friend";
                    btnAction = shareGame;
                } else {
                    resultScoreText += `\n\nSTAGE 1 CLEARED!\nAdvancing to Stage 2...`;
                    btnText = "Start Stage 2";
                }
            }
            // Check after Round 20 (End of Stage 2)
            else if (gameState.round === 20) {
                if (gameState.totalScore < BONUS_ROUND_UNLOCK_SCORE) {
                    resultTitleText = "GAME OVER";
                    titleClass = "result-title text-glow-red";
                    resultScoreText = `Score: ${gameState.totalScore}. You need ${BONUS_ROUND_UNLOCK_SCORE} for Bonus.`;
                    btnText = "Send to a Friend";
                    btnAction = shareGame;
                } else {
                    resultTitleText = "BONUS UNLOCKED!";
                    titleClass = "result-title text-glow-gold"; // New Gold Style
                    resultScoreText += `\n\n1000+ Points Reached!\nEntering Bonus Round...`;
                    btnText = "Start Bonus Round";
                }
            }
            // End of Game (Round 25)
            else if (gameState.round === 25) {
                 btnText = "Finish Game";
            }

            // Apply to Overlay elements
            resultTitleEl.textContent = resultTitleText;
            resultTitleEl.className = titleClass;
            resultScoreEl.innerText = resultScoreText; 
            
            overlayNextButtonEl.textContent = btnText;
            // Reset button style to standard next/action style
            if (btnAction === shareGame) {
                 overlayNextButtonEl.classList.remove('bg-indigo-600', 'hover:bg-indigo-500');
                 overlayNextButtonEl.classList.add('bg-green-600', 'hover:bg-green-500');
            } else {
                 overlayNextButtonEl.classList.remove('bg-green-600', 'hover:bg-green-500');
                 overlayNextButtonEl.classList.add('bg-indigo-600', 'hover:bg-indigo-500');
            }
            overlayNextButtonEl.onclick = btnAction;
            
            // Trigger Animation
            resultOverlayEl.classList.add('active');

            // Highlight buttons (behind overlay)
            Array.from(choicesContainerEl.children).forEach(btn => {
                btn.disabled = true;
                const choice = btn.getAttribute('data-choice');
                if (choice === gameState.currentMovie.correct) {
                    btn.classList.add('correct', 'bg-blue-600');
                } else if (btn === clickedButton) {
                    btn.classList.add('incorrect', 'bg-blue-600');
                }
            });
        }
    </script>
</body>
</html>
